---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

I unzip and load the data.

```{r}
unzip("activity.zip")
df <- read.csv("activity.csv")
summary(df)
```

The interval has a time format:

```{r}
unique(df$interval)
```

I combine the date and the interval into a datetime.

```{r}
df$datetime <- as.POSIXct(paste(df$date, sprintf("%.4d", df$interval)), format="%Y-%m-%d %H%M")

```

I parse the date string into a date value. 

```{r}
df$date <- as.Date(df$date, format="%Y-%m-%d")
```

I parse the interval into a datetime where I will only use the time.

```{r}
df$time <- as.POSIXct(sprintf("%.4d", df$interval), format="%H%M")
```


## What is mean total number of steps taken per day?

I keep the part of the data where the steps are not missing.

```{r}
df.not.na <- df[!is.na(df$steps),]
total <- aggregate(df.not.na$steps, list(df.not.na$date), sum)
names(total) <- c("date", "steps")

meanTotalSteps <- mean(total$steps)
medianTotalSteps <- median(total$steps)
```

The total number of steps per day has

- mean equal to **```r sprintf("%.1f", meanTotalSteps)```**, and
- median equal to **```r medianTotalSteps```**.

I make a histogram of the total number of steps pre day, and draw the mean and the median.

```{r}
library(ggplot2)
h <- ggplot(total, aes(x=steps)) + 
     geom_histogram(binwidth=1000, colour="black", fill="red") + 
     xlab("Total number of steps per day") +
     geom_vline(xintercept=meanTotalSteps, color="blue", size=1.5) +
     geom_vline(xintercept=medianTotalSteps, color="green", linetype="dashed", size=1.5) + 
     geom_text(aes(x=meanTotalSteps, label="\nMean", y=7), 
               colour="blue", angle=90, text=element_text(size=10)) +
     geom_text(aes(x=medianTotalSteps, label="Median\n", y=7), 
               colour="green", angle=90, text=element_text(size=10))
h
```


## What is the average daily activity pattern?

I average the number of steps for each 5-minute interval accross all days.

```{r}
average <- aggregate(df.not.na$steps, list(df.not.na$time), mean)
names(average) <- c("time", "steps")
```

I find the time of the interval with the maximum number of steps.

```{r}
maxStepInterval <- average[which.max(average$steps),]$time
maxStepTime <- strftime(maxStepInterval, format="%H:%M")
```

On average across all the days in the dataset, the maximum number of steps are in the 5-minute interval at **`r maxStepTime`**.

I make a time series plot of the average number of steps for each 5-minute interval of the day.

```{r}
library(scales)

p <- ggplot(average, aes(x=time, y=steps)) + geom_line() +
     xlab("5-minute interval") +
     ylab("Average number of steps") +
     scale_x_datetime(breaks=("2 hour"), 
                      labels=date_format("%H:%M")) +
     geom_vline(xintercept=as.numeric(maxStepInterval), color="red", linetype="dashed", size=0.5) +
     geom_text(aes(x=maxStepInterval, label=paste(maxStepTime, "\n"), y=25), 
               colour="red", angle=90, text=element_text(size=7))
     
p
```

## Imputing missing values



## Are there differences in activity patterns between weekdays and weekends?
